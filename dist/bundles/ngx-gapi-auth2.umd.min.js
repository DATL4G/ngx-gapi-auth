!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-gapi-auth2",["exports","@angular/core","rxjs","rxjs/operators","@angular/common"],t):t((e=e||self)["ngx-gapi-auth2"]={},e.ng.core,e.rxjs,e.rxjs.operators,e.ng.common)}(this,(function(e,t,o,n,r){"use strict";var i=function(){function e(e){this.clientConfig=e,this.mocked=e.e2e}return e.prototype.getMocked=function(){return this.mocked},e.prototype.getClientConfig=function(){return this.clientConfig},e}();var a=function(e,t,o,n,r,i,a){this.id=e,this.firstName=t,this.lastName=o,this.email=n,this.avatar=r,this.idToken=i,this.tokenExpiresAt=a};var u=new t.InjectionToken("ng-gapi.config"),s=function(){function e(e){this.gapiUrl="https://apis.google.com/js/api.js",this.config=new i(e),this.loadGapi().subscribe()}return e.prototype.onLoad=function(){return this.loadGapi()},e.prototype.getConfig=function(){return this.config},e.prototype.isMocked=function(){return this.config.getMocked()},e.prototype.loadGapi=function(){var e=this;return new o.Observable((function(t){var o=document.createElement("script");o.src=e.gapiUrl,o.type="text/javascript",o.charset="utf-8",document.getElementsByTagName("head")[0].appendChild(o),o.onload=function(){t.next(!0),t.complete()}}))},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[u]}]}]},e}();var c=function(){function e(e){var t=this;this.googleApi=e,this.GoogleAuth=void 0,this.googleApi.onLoad().subscribe((function(){t.loadGoogleAuth2().subscribe()}))}return e.prototype.getAuth=function(e){var t=this;return void 0===e&&(e=!1),!this.GoogleAuth||e?this.googleApi.onLoad().pipe(n.mergeMap((function(){return t.loadGoogleAuth2()}))):o.of(this.GoogleAuth)},e.prototype.loadGoogleAuth2=function(){var e=this;return new o.Observable((function(t){gapi.load("auth2",(function(){gapi.auth2.init(e.googleApi.getConfig().getClientConfig()).then((function(o){e.GoogleAuth=o,t.next(o),t.complete()})).catch((function(e){return t.error(e)}))}))}))},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:s}]},e}();var g=function(){function e(e,t,r){var i=this;this.googleAuth2LoaderService=e,this.googleApiLoaderService=t,this.ngZone=r,this._authState=new o.ReplaySubject(1),this.googleApiLoaderService.isMocked()?this.signIn():this.googleApiLoaderService.onLoad().subscribe((function(){i.googleAuth2LoaderService.getAuth().subscribe((function(e){i.auth=e,i.auth.currentUser.get().isSignedIn()?i.refreshToken():i._authState.next(null)})),o.interval(12e5).pipe(n.tap((function(){return i.refreshToken()}))).subscribe()}))}return Object.defineProperty(e.prototype,"authState",{get:function(){return this._authState.asObservable()},enumerable:!0,configurable:!0}),e.prototype.signIn=function(){this.googleApiLoaderService.isMocked()?this._authState.next(JSON.parse(localStorage.getItem("user"))):this.auth.signIn({prompt:"select_account",ux_mode:"redirect",redirect_uri:window.location.origin})},e.prototype.signOut=function(){this.googleApiLoaderService.isMocked()||this.auth.signOut(),this._authState.next(null)},e.prototype.refreshToken=function(){var e=this;return this.auth.currentUser.get().reloadAuthResponse().then((function(t){e.ngZone.run((function(){return e._authState.next(e.getProfile(t.id_token,t.expires_at))}))}))},e.prototype.getProfile=function(e,t){var o=this.auth.currentUser.get().getBasicProfile();return o?{id:o.getId(),email:o.getEmail(),firstName:o.getGivenName(),lastName:o.getFamilyName(),avatar:o.getImageUrl(),idToken:e,tokenExpiresAt:t}:null},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:c},{type:s},{type:t.NgZone}]},e}();var p=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[t,s,c,g]}},e.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule]}]}],e}();e.AuthUser=a,e.GoogleApiConfig=i,e.GoogleApiLoaderService=s,e.GoogleAuth2LoaderService=c,e.GoogleAuthService=g,e.GoogleOauthModule=p,e.NG_GAPI_CONFIG=u,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-gapi-auth2.umd.min.js.map